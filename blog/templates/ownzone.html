{% extends "includes/base.html" %}
{% block title %}{{username}}'s zone{% endblock %}
{% block script %}
<style type="text/css">
	.owndiv {
		width: 70%;
		position: relative;
		padding-right: 15px;
		padding-left: 15px;
		margin: 50px auto auto auto;
		border: 1px solid;
		border-radius: 5px;
	}
</style>
{% endblock %}
{% block content %}
<div class="container">
	<div class="row">
		<div class="col-md-12 column">
			<div class="jumbotron">
				<h1>
					Hello, {{username}}
				</h1>
				<form role="form">
				<div class="form-group">
					<textarea class="form-control" id='submitcontent' name='submitcontent' placeholder="分享你的故事..." rows="3"></textarea>
				</div>
				</form>
				<!-- <input type="text" name="error_msg" /> -->
				<p>
					 <input id="btn1" type="button" onclick="ajaxpost();" value="submit">
				</p>
			</div>
			<grammarly>
				<div class="_1BN1N Kzi1t _2SRUV _2DJZN">
					<div class="_1HjH7">
						<div class="_3qe6h">
						</div>
					</div>
				</div>
			</grammarly>
		</div>
	</div>
</div>
{% for post in posts %}
<div class="owndiv" id="div{{post.cid}}">
	<div class="row">
		<div class="col-md-12 column">
			<div class="Contentdiv1">
				<p>
					 {{ post.content }}
				</p>
				<dl>
				<dd>
					{{ post.posttime }}
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					{{ post.postposition }}
				</dd>
				</dl>
				<!-- <button type="button" class="btn btn-default">顶&nbsp;{{ post.ding }}</button>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -->
				<button type="button" class="btn btn-default">踩&nbsp;{{ post.cai }}</button>
				<button type="button" onclick="ajax_delete({{ post.cid }});" class="btn btn-default">删除</button>
			</div>
		</div>
	</div>
</div>
{% endfor %}
<script type="text/javascript">
function ajax_delete(cid){
    $.ajax({
        url: "/ajax_remove_content/",
        type: "POST",
        data: {"cid": cid},
        headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},
        success: function(data){
            var obj = JSON.parse(data);//字符串转对象
            if(obj.status){
            	$('#div'+cid).remove();
            }else{
                // $('#erro_msg').text(obj.error);
                alert(obj.error);
            }
        }
    });
}
function ajaxpost(){
    $.ajax({
        url: "/submit_text/",
        type: "POST",
        data: {"content": $('#submitcontent').val()},
        headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},
        success: function(data){
            var obj = JSON.parse(data);//字符串转对象
            if(obj.status){
            	alert('发布成功！');
                location.reload();  //如果没有错重新加载页面（刷新））
            }else{
                // $('#erro_msg').text(obj.error);
                alert(obj.error);
            }
        }
    });
}
</script>
{% endblock %}
